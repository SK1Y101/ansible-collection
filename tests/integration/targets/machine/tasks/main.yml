---
- environment:
    MAAS_HOST: "{{ host }}"
    MAAS_TOKEN_KEY: "{{ token_key }}"
    MAAS_TOKEN_SECRET: "{{ token_secret }}"
    MAAS_CUSTOMER_KEY: "{{ customer_key }}"


  block:
    - name: Delete machine
      canonical.maas.instance:
        fqdn: machine-test.maas
        state: absent

    # # TODO: Add/Update after vm_host_machine module is updated with fqdn
    # - name: Create virtual machine with two disks and a network interface.
    #   canonical.maas.vm_host_machine:
    #     hostname: instance-test
    #     vm_host: sunny-raptor
    #     cores: 2
    #     memory: 2000
    #     network_interfaces:
    #       label_name: my_first
    #       subnet_cidr: "10.10.10.0/24"
    #     storage_disks:
    #       - size_gigabytes: 8
    #   register: initial_machine
    # - ansible.builtin.assert:
    #     that:
    #       - initial_machine is changed
    #       - initial_machine.record.hostname == "instance-test"
    #       - initial_machine.record.fqdn == "instance-test.maas"
    #       - initial_machine.record.memory == 2000
    #       - initial_machine.record.cores == 2
